{
    "collab_server" : "",
    "contents" : "#Richa Bhattacharya\n#Mentor David Cohn\n#Summary Statistics and Survival Analysis for Brain Cancer Survival Data\n\n#Setting the working directory\ncode.directory = \"BrainCancerSurvivalAnalysis\"\nsetwd = code.directory\n\n#Loading libraries needed\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(survival)\nlibrary(survminer)\n\n#TO DO: Alter code to read the CSV file \n#dataextract <- read.csv(file = \"dataextract\")\ndataextractCopy <- dataextract\n\n#Count of NA Values \nNAValues <- data.frame(NA.count = colSums(is.na(dataextractCopy)))\n\n#Merge same Medical Facilities\ndataextractCopy$Medical.Facility = trimws(dataextractCopy$Medical.Facility)\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"St. Joseph's Hospital AZ\" |\ndataextractCopy$Medical.Facility == \"St. Joseph's Hospital (AZ)\"] = \"St. Joseph's Hospital (AZ)\"\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"University of North Carolina\" | \ndataextractCopy$Medical.Facility == \"UNC\"] = \"University of North Carolina\"\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"MD Anderson\" | \ndataextractCopy$Medical.Facility == \"MD Anderson Cancer Center\"] = \"MD Anderson\"\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"Case Western\" | \ndataextractCopy$Medical.Facility == \"Case Western - St Joes\"] = \"Case Western\"\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"Fondazione-Besta\" |\ndataextractCopy$Medical.Facility == \"Milan - Italy, Fondazione IRCCS Instituto Neuroligico C. Besta\"] = \"Fondazione-Besta\"\n\ndataextractCopy$Medical.Facility[dataextractCopy$Medical.Facility == \"UCSF\" |\ndataextractCopy$Medical.Facility == \"University of California San Francisco\"] = \"University of California San Francisco\"\n\n\n#Age Mean and Median by Grade \nage.grade.mean.summary = dataextractCopy %>%\n  filter(!(is.na(Grade)) & !(is.na(Age.at.diagnosis))) %>%\n  group_by(Grade) %>%\n  summarise(Mean.Age = mean(Age.at.diagnosis))\n\nage.grade.median.summary = dataextractCopy %>%\n  filter(!(is.na(Grade)) & !(is.na(Age.at.diagnosis))) %>%\n  group_by(Grade) %>%\n  summarise(Median.Age = median(Age.at.diagnosis))\n\nage.grade.summary = inner_join(age.grade.median.summary, age.grade.mean.summary,\n                               by = \"Grade\")\n\n\n#Age Mean and Median by Medical Facility \nage.mean.medical.facility = dataextractCopy %>%\n  filter(!(is.na(Age.at.diagnosis)) & !(is.na(Medical.Facility))) %>%\n  group_by(Medical.Facility) %>%\n  summarise(Mean.Age = mean(Age.at.diagnosis))\n\nage.median.medical.facility = dataextractCopy %>%\n  filter(!(is.na(Age.at.diagnosis)) & !(is.na(Medical.Facility))) %>%\n  group_by(Medical.Facility) %>%\n  summarise(Median.Age = median(Age.at.diagnosis))\n\nage.medical.facility.summary = inner_join(age.mean.medical.facility, age.median.medical.facility,\n                                          by = \"Medical.Facility\")\n\n#Age Distribution for Grade 2 Tumor\nG2Age <- qplot(select(filter(select(dataextractCopy, Age.at.diagnosis, Grade),\nGrade == \"G2\"), Age.at.diagnosis),geom = \"histogram\", \nbinwidth = 0.5, main = \"Histogram for G2\", xlab = \"Age\",\nfill = I(\"blue\"), col = I(\"black\"),alpha = I(.2), xlim = c(0,100))\n\n\n#Age Distribution for Grade 3 Tumor \nG3Age <- qplot(select(filter(select(dataextractCopy, Age.at.diagnosis, Grade),\nGrade == \"G3\"), Age.at.diagnosis),geom = \"histogram\", \nbinwidth = 0.5, main = \"Histogram for G3\", xlab = \"Age\",\nfill = I(\"blue\"), col = I(\"black\"),alpha = I(.2), xlim = c(0,100))\n\n\n#Age Distribution for Grade 4 Tumor\nG4Age <- qplot(select(filter(select(dataextractCopy, Age.at.diagnosis, Grade), \nGrade == \"G4\"), Age.at.diagnosis),geom = \"histogram\",\nbinwidth = 0.5, main = \"Histogram for G4\", xlab = \"Age\", \nfill = I(\"blue\"), col = I(\"black\"),alpha = I(.2), xlim = c(0,100))\n\n#Total Count of each of the studies \nstudy.data <- summarize(group_by(dataextractCopy,Study), Count = n())\n\n#Glioblastoma multiforme per Facility\nstudy.gbm <- data.frame(summarize(group_by(filter(dataextractCopy,\nStudy == \"Glioblastoma multiforme\"), Medical.Facility), GBM = n()))\n\n#Brain Lower Grade Glioma\nstudy.lgg <- data.frame(summarize(group_by(filter(dataextractCopy,\nStudy == \"Brain Lower Grade Glioma\"), Medical.Facility), LGG= n()))\n\n\n#Dataframes of # of each grade per Histology\ngrade2 <- data.frame(summarize(group_by(filter(dataextractCopy,\nGrade == \"G2\"), Histology), G2= n()))\ngrade3 <-data.frame(summarize(group_by(filter(dataextractCopy,\nGrade == \"G3\"), Histology), G3= n()))\ngrade4 <-data.frame(summarize(group_by(filter(dataextractCopy,\nGrade == \"G4\"), Histology), G4= n()))\n\n#combined graph of the above dataframes\n# Could not find a convenient way to join all graphs since G4 is only glioblastoma and \n#     G3 and G2 are a combination of astrocytoma, oligodendroglioma, oligoastrocytoma\nGradeData <- data.frame(\n  Histology = c(\"astrocytoma\", \"oligodendroglioma\", \"oligoastrocytoma\", \"glioblastoma\"),\n  G2 = c(grade2[1,2], grade2[2,2], grade2[3,2],0),\n  G3 = c(grade3[1,2], grade3[2,2], grade3[3,2],0),\n  G4 = c(0,0,0, grade4[1,2]))\n\n#Total Number of Females Per Facility\nFemale <- data.frame(summarize(group_by(filter(dataextractCopy,\nGender == \"female\"), Medical.Facility),Females_per_Facility= n()))\n\n\n#Total Number of Males Per Facility\nMale <- data.frame(summarize(group_by(filter(dataextractCopy,\nGender == \"male\"), Medical.Facility),Males_per_Facility= n()))\n\n\n#Total Count of Patients per Facility \nPatients <- data.frame(summarize(group_by\n(dataextractCopy, Medical.Facility), Count= n()))\n\n#Percent Aneuploidy by Grade \naneuploidy.grade.mean.summary = dataextractCopy %>%\n  filter(!(is.na(Grade)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Grade) %>%\n  summarise(Mean.Percent = mean(Percent.Aneuploidy))\n\naneuploidy.grade.median.summary = dataextractCopy %>%\n  filter(!(is.na(Grade)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Grade) %>%\n  summarise(Median.Percent = median(Percent.Aneuploidy))\n\naneuploidy.grade.summary = inner_join(aneuploidy.grade.mean.summary, aneuploidy.grade.median.summary,\n                               by = \"Grade\")\n\n#Percent Aneuploidy by Histology \naneuploidy.grade.mean.summary = dataextractCopy %>%\n  filter(!(is.na(Histology)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Histology) %>%\n  summarise(Mean.Percent = mean(Percent.Aneuploidy))\n\naneuploidy.grade.median.summary = dataextractCopy %>%\n  filter(!(is.na(Histology)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Histology) %>%\n  summarise(Median.Percent = median(Percent.Aneuploidy))\n\naneuploidy.grade.summary = inner_join(aneuploidy.grade.mean.summary, aneuploidy.grade.median.summary,\nby = \"Histology\")\n\n#Percent Aneuploidy by Gender \naneuploidy.gender.mean.summary = dataextractCopy %>%\n  filter(!(is.na(Gender)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Gender) %>%\n  summarise(Mean.Percent = mean(Percent.Aneuploidy))\n\naneuploidy.gender.median.summary = dataextractCopy %>%\n  filter(!(is.na(Gender)) & !(is.na(Percent.Aneuploidy))) %>%\n  group_by(Gender) %>%\n  summarise(Median.Percent = median(Percent.Aneuploidy))\n\naneuploidy.gender.summary = inner_join(aneuploidy.gender.mean.summary, aneuploidy.gender.median.summary,\nby = \"Gender\")\n\n\n#Modifying the Survival Data\n#Excludes NA, negative / 0 months, caps at followup.threshold\nfollowup.threshold = 36\nsurvival.data = dataextractCopy %>%\nfilter(!is.na(Survival.Months) & Survival.Months > 0) %>%\nmutate(Survival.Months.Threshold = ifelse(Survival.Months > followup.threshold,\n    followup.threshold, Survival.Months)) %>%\nmutate(Survival.Status.Threshold = ifelse(Survival.Months > followup.threshold &\n    Survival.Status == 1, 0, Survival.Status))\n#Creating a copy \nKM.dataframe = survival.data\n\n#Kaplan Meier Curves for G2,G3,G4 Tumors \nKM.dataframe$SurvObject = with(KM.dataframe,\nSurv(Survival.Months.Threshold, Survival.Status.Threshold))\nkaplan.meier.fit = surv_fit(SurvObject ~ Grade, data = KM.dataframe, \nconf.type = \"log-log\")\nKM.plot.grade = ggsurvplot(kaplan.meier.fit, conf.int = TRUE, title = \"Kaplan Meier Analysis by Tumor Grade\",\nxlab = \"Months\", ylab = \"Probability\", risk.table = TRUE, break.x.by = 6)\nKM.plot.grade$plot = KM.plot.grade$plot + theme(plot.title = element_text(hjust = 0.5)) \nprint(KM.plot.grade)\n\n#Kaplan Meier Curves for Histology\nKM.dataframe = filter(survival.data, Histology != \"glioblastoma\")\nKM.dataframe$SurvObject = with(KM.dataframe,\nSurv(Survival.Months.Threshold, Survival.Status.Threshold))\nkaplan.meier.fit = surv_fit(SurvObject ~ Histology, data = KM.dataframe,\nconf.type = \"log-log\")\nKM.plot.histology = ggsurvplot(kaplan.meier.fit, conf.int = TRUE, title = \"Kaplan Meier Analysis by Histology\",\nxlab = \"Months\", ylab = \"Probability\", risk.table = TRUE, break.x.by = 6)\nKM.plot.histology$plot = KM.plot.histology$plot + theme(plot.title = element_text(hjust = 0.5)) \nprint(KM.plot.histology)\n\n#Sorting Age Data into greater than / less than 50 (40 for G2)\nage.data <- select(dataextractCopy, Grade, Age.at.diagnosis,Survival.Months,Survival.Status)\nage.data <-filter(age.data, Survival.Months > 0 &!is.na(Grade) & !is.na(Survival.Months) & \n  !is.na(Age.at.diagnosis) & !is.na(Survival.Status))\n\n#Kaplan Meier Curves for G2,G3,G4 Tumors \nG2 <- filter(age.data, Grade == \"G2\")\nG2 <- mutate(G2,g.or.l = ifelse(Age.at.diagnosis > 40 & Grade == \"G2\", \">40\", \"<40\"))\nG2$g.or.l = as.factor(G2$g.or.l)\nG3 <- filter(age.data, Grade == \"G3\")\nG3 <- mutate(G3,g.or.l = ifelse(Age.at.diagnosis > 50 & Grade == \"G3\", \">40\", \"<40\"))\nG3$g.or.l = as.factor(G3$g.or.l)\nG4 <- filter(age.data, Grade == \"G4\")\nG4 <- mutate(G4,g.or.l = ifelse(Age.at.diagnosis > 50 & Grade == \"G4\", \">40\", \"<40\"))\nG4$g.or.l = as.factor(G4$g.or.l)\n\n#Kaplan Meier Curves for G2 Age Distribution (greater/less than 40)\nSurvObject = with(G2,Surv(G2$Survival.Months, G2$Survival.Status))\nkaplan.meier.fit = surv_fit(SurvObject ~ G2$g.or.l, data = G2, \nconf.type = \"log-log\")\nKM.plot.G2 = ggsurvplot(kaplan.meier.fit, conf.int = TRUE, title = \"Kaplan Meier Curves for G2\",\nxlab = \"Months\", ylab = \"Probability\", risk.table = TRUE, break.x.by = 6)\nKM.plot.G2$plot = KM.plot.G2$plot + theme(plot.title = element_text(hjust = 0.5)) \nKM.plot.G2\n\n#Kaplan Meier Curves for G3 Age Distribution (greater/less than 50)\nSurvObject = with(G3,Surv(G3$Survival.Months, G3$Survival.Status))\nkaplan.meier.fit = surv_fit(SurvObject ~ G3$g.or.l, data = G3, \nconf.type = \"log-log\")\nKM.plot.G3 = ggsurvplot(kaplan.meier.fit, conf.int = TRUE, title = \"Kaplan Meier Curves for G3\",\nxlab = \"Months\", ylab = \"Probability\", risk.table = TRUE, break.x.by = 6)\nKM.plot.G3$plot = KM.plot.G3$plot + theme(plot.title = element_text(hjust = 0.5)) \nKM.plot.G3\n\n#Kaplan Meier Curves for G4 Age Distribution (greater/less than 50)\nSurvObject = with(G4,Surv(G4$Survival.Months, G4$Survival.Status))\nkaplan.meier.fit = surv_fit(SurvObject ~ G4$g.or.l, data = G4, \nconf.type = \"log-log\")\nKM.plot.G4 = ggsurvplot(kaplan.meier.fit, conf.int = TRUE, title = \"Kaplan Meier Curves for G4\",\nxlab = \"Months\", ylab = \"Probability\", risk.table = TRUE, break.x.by = 6)\nKM.plot.G4$plot = KM.plot.G4$plot + theme(plot.title = element_text(hjust = 0.5)) \nKM.plot.G4\n\n#Karnofsky Performance Score Count \nk.score <- summarize(group_by(dataextractCopy, Karnofsky.Performance.Score), Count = n())\n\n#Mutation Count\nqplot(filter(select(dataextractCopy, Mutation.Count), !is.na(Mutation.Count)),geom = \"histogram\",\nbinwidth = 0.5, main = \"Mutation Count\", xlab = \"Mutation Count\", \nfill = I(\"blue\"), col = I(\"black\"),alpha = I(.2), xlim = c(0,100))\n\n#Karnofsky Score\nqplot(filter(select(dataextractCopy, Karnofsky.Performance.Score), !is.na(Karnofsky.Performance.Score)),geom = \"histogram\",\nbinwidth = 0.5, main = \"Karnofsky Score Histogram\", xlab = \"Karnofsky Score\", \nfill = I(\"blue\"), col = I(\"black\"),alpha = I(.2), xlim = c(0,100))\n\n#Grade v. Karnofsky Score \n#how do you have multiple if statements for three bins\nkarnofsky.data <- filter(select(dataextractCopy, Grade, Karnofsky.Performance.Score), \n       !is.na(Grade) &!is.na(Karnofsky.Performance.Score))\nG2 <- filter(karnofsky.data, Grade == \"G2\")\nG2 <- mutate(G2,g.or.l = ifelse(Karnofsky.Performance.Score > 40 & Grade == \"G2\", \">40\", \"<40\"))\nG2$g.or.l = as.factor(G2$g.or.l)\nG3 <- filter(karnofsky.data, Grade == \"G3\")\nG3 <- mutate(G3,g.or.l = ifelse(Karnofsky.Performance.Score > 50 & Grade == \"G3\", \">40\", \"<40\"))\nG3$g.or.l = as.factor(G3$g.or.l)\nG4 <- filter(karnofsky.data, Grade == \"G4\")\nG4 <- mutate(G4,g.or.l = ifelse(Karnofsky.Performance.Score > 50 & Grade == \"G4\", \">40\", \"<40\"))\nG4$g.or.l = as.factor(G4$g.or.l)\n",
    "created" : 1503880756803.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3721682982",
    "id" : "2AEAE683",
    "lastKnownWriteTime" : 1503263451,
    "last_content_update" : 1503263451,
    "path" : "~/BrainCancerSurvivalAnalysis/Script for Summary Statistics.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}